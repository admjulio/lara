<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat Unimed – Lara & Alice</title>
  <style>
    :root {
      --unimed-green: #008542;
      --unimed-green-dark: #006b34;
      --bg: #f6f7f9;
      --text: #111;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      color: var(--text);
      background: var(--bg);
      text-align: center;
    }
    header {
      background: var(--unimed-green);
      padding: 16px 20px;
    }
    header img { max-height: 56px; }
    main {
      padding: 36px 20px 80px;
      max-width: 900px;
      margin: 0 auto;
    }
    h1 { margin: 0 0 8px; font-size: 28px; }
    p  { margin: 0 0 24px; }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 6px;
      background: var(--unimed-green);
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
      border: 0;
      transition: filter .2s ease, background .2s ease;
      user-select: none;
    }
    .btn:hover { background: var(--unimed-green-dark); }
    #div_chatbot {
      position: fixed;
      z-index: 100000;
      bottom: 15px;
      right: 15px;
    }
    #div_chatbot img {
      width: 180px;
      height: 180px;
      cursor: pointer;
      filter: drop-shadow(0 8px 20px rgba(0,0,0,.2));
      transition: transform .15s ease;
    }
    #div_chatbot img:hover { transform: scale(1.03); }
    footer {
      margin: 40px 0 20px;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>

  <header>
    <img src="https://www.unimed.coop.br/site/image/layout_set_logo?img_id=1300085" alt="Unimed" />
  </header>

  <main>
    <h1>Atendimento Digital</h1>
    <p>Clique para abrir o chat em <b>pop-up</b> usando o widget UC2B.</p>

    <p>
      <a class="btn" href="javascript:void(0);" id="btn-alice">Abrir chat da Alice</a>
    </p>
  </main>

  <!-- Lara fixa no canto que abre em pop-up -->
  <div id="div_chatbot">
    <a href="javascript:void(0);" id="btn-lara" aria-label="Abrir chat da Lara em pop-up">
      <img
        src="https://www.unimed.coop.br/site/documents/4195185/0/lara.png/28fd2d03-20d4-cba3-0117-f8d2f6446082?t=1649783866815"
        alt="Lara - Assistente virtual"
      />
    </a>
  </div>

  <footer>
    <span>© Unimed • Ambiente de testes do chat UC2B</span>
  </footer>

  <script>
    /**
     * Abre uma janela pop-up (500x600) e injeta o UC2BChat com o flow correto.
     */
    function openChatInPopupWithUC2B(flowId) {
      var w = window.open(
        'about:blank',
        'chat_window',
        'width=500,height=600,resizable=yes,scrollbars=yes'
      );

      if (!w) {
        alert('Seu navegador bloqueou o pop-up. Permita pop-ups para este site.');
        return;
      }

      var html = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Chat Unimed</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; }
    h2 { color:#008542; }
  </style>
</head>
<body>
  <h2>Carregando atendimento…</h2>

  <!-- Loader oficial UC2BChat -->
  <script>
    (function(w, d, s, u) {
      w.UC2BChat = function(c) { w.UC2BChat._.push(c) };
      w.UC2BChat._ = [];
      w.UC2BChat.url = u;
      var h = d.getElementsByTagName(s)[0], j = d.createElement(s);
      j.async = true;
      j.src = "https://unimedomni.cloudcanal.com.br/livechat/livechat.min.js";
      h.parentNode.insertBefore(j, h);
    })(window, document, 'script', "https://unimedomni.cloudcanal.com.br/livechat");
  <\/script>

  <script>
    // Configura o flow quando o widget carregar
    (function initChat(flowId){
      function tryOpen() {
        if (!window.UC2BChat || typeof window.UC2BChat !== 'function') {
          return setTimeout(tryOpen, 200);
        }
        UC2BChat(function () {
          if (typeof this.setLinkedToFlow === 'function') {
            this.setLinkedToFlow(flowId);
            console.log("Flow setado:", flowId);
          }
        });
      }
      tryOpen();
    })('${flowId}');
  <\/script>
</body>
</html>
      `;

      w.document.open();
      w.document.write(html);
      w.document.close();
    }

    // Ligações dos botões
    (function bindUI() {
      var btnAlice = document.getElementById('btn-alice');
      var btnLara  = document.getElementById('btn-lara');

      if (btnAlice) {
        btnAlice.addEventListener('click', function (e) {
          e.preventDefault();
          openChatInPopupWithUC2B('68a46e661790425f4016a228'); // Alice
        });
      }
      if (btnLara) {
        btnLara.addEventListener('click', function (e) {
          e.preventDefault();
          openChatInPopupWithUC2B('673f883adc527a52ff1ae5c9'); // Lara
        });
      }
    })();
  </script>
</body>
</html>
